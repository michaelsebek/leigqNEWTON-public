<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2024b"><title>Sphere Hunting</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 10px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(128, 128, 128); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 15px; font-weight: 700; text-align: left;  }
.S2 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(128, 128, 128); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 700; text-align: left;  }
.S3 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-size: 14px;  }
.S4 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }
.S5 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 25px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 15px 10px 0; display: inline-block }
.S6 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S7 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 25px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif, Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.eoOutputWrapper { width: calc(90vw - 10px) !important; }
.S10 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S11 { color: rgb(33, 33, 33); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 17.234px;  }
/* Styling that is common to warnings and errors is in diagnosticOutput.css */.embeddedOutputsErrorElement {    min-height: 18px;    max-height: 550px;}
.embeddedOutputsErrorElement .diagnosticMessage-errorType {    overflow: auto;}
.embeddedOutputsErrorElement.activeOutput .eoOutputContent {    user-select: text;    -webkit-user-select: text;}
.embeddedOutputsErrorElement.activeOutput .eoOutputContent button {    user-select: none;    -webkit-user-select: none;}
.embeddedOutputsErrorElement .eoOutputContent ::selection {}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
/* Styling that is common to warnings and errors is in diagnosticOutput.css */.embeddedOutputsWarningElement {    min-height: 18px;    max-height: 550px;}
.embeddedOutputsWarningElement .diagnosticMessage-warningType {    overflow: auto;}
.embeddedOutputsWarningElement.activeOutput .eoOutputContent {    user-select: text;    -webkit-user-select: text;}
.embeddedOutputsWarningElement .eoOutputContent ::selection {}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
/* Copyright 2015-2023 The MathWorks, Inc. *//* In this file, styles are not scoped to rtcContainer since they could be in the Dojo Tooltip */.diagnosticMessage-wrapper {    font-family: Menlo, Monaco, Consolas, "Courier New", monospace;    font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {    /*This fallback value will be used for appdesigner warnings*/    color: var(--rtc-warning-output-color, var(--mw-color-matlabWarning));}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {    /*This fallback value will be used for appdesigner warnings*/    color: var(--rtc-warning-output-color, var(--mw-color-matlabWarning));    text-decoration: underline;}
.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-warningType,.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-warningType a {    color: var(--mw-color-matlabWarning) !important;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {    /*This fallback value will be used in appdesigner error tooltip text*/    color: var(--rtc-error-output-color, var(--mw-color-matlabErrors));}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {    /*This fallback value will be used in appdesigner error tooltip text*/    color: var(--rtc-error-output-color, var(--mw-color-matlabErrors));    text-decoration: underline;}
.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-errorType,.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-errorType a {    color: var(--mw-color-matlabErrors) !important;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart,.diagnosticMessage-wrapper .diagnosticMessage-causePart {    white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {    white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {    white-space: pre;    word-wrap:  initial;    min-height: 18px;    max-height: 550px;}
.embeddedOutputsTextElement .textElement,.embeddedOutputsVariableStringElement .textElement {    overflow: auto;}
.embeddedOutputsTextElement.activeOutput .eoOutputContent,.embeddedOutputsVariableStringElement.activeOutput .eoOutputContent {    user-select: text;    -webkit-user-select: text;}
/*embeddedOutputsTextElement has a different dom structure than embeddedOutputsVariableStringElement.Unlike variableString, the text output has both TEXT nodes and elements as children. Hence we needa selector for each.*/.embeddedOutputsTextElement .eoOutputContent::selection,.embeddedOutputsTextElement .eoOutputContent ::selection,.embeddedOutputsVariableStringElement .eoOutputContent ::selection {}
.textElement,.rtcDataTipElement .textElement {    padding-top: 2px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {    min-height: 16px;}
.rightPaneElement .textElement {    padding-top: 2px;    padding-left: 9px;}
.S12 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px; padding: 6px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S13 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S14 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 4px 4px 0px 0px; padding: 6px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace, Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Sphere Hunting</span></h1><h4  class = 'S1'><span>Tries to detect and validate</span><span> </span><span style=' font-weight: bold;'>spherical components</span><span> in the left spectrum. </span></h4><div  class = 'S2'><span>Typical workflow: </span></div><ol  class = 'S3'><li  class = 'S4'><span>sample many left-eigenvalue candidates (Newton runs) </span></li><li  class = 'S4'><span>detect/fit candidate spheres from DISTINCT samples </span></li><li  class = 'S4'><span>refine + validate (grid test) to decide sphere-vs-artifact</span></li></ol><div  class = 'S2'><span>This page is written to be</span><span> </span><span style=' font-weight: bold;'>documentation-friendly</span><span>: - </span></div><ul  class = 'S3'><li  class = 'S4'><span>Default profile aims to finish quickly (less than a minute), yet produce a reliable decision.</span></li><li  class = 'S4'><span>A heavier profile is provided for research runs.</span></li></ul><h2  class = 'S5'><span>0) Setup (requirements + path)</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >rng(0,</span><span style="color: #a709f5;">'twister'</span><span >); </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >hasQuat = true;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">try</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    quaternion(0,0,0,0);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">catch</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    hasQuat = false;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">if </span><span >~hasQuat</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    disp(</span><span style="color: #a709f5;">"This toolbox requires MATLAB's built-in quaternion class (Aerospace Toolbox)."</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    disp(</span><span style="color: #a709f5;">"Examples in this page are skipped."</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">return</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #008013;">% Ensure toolbox root is on the path (add only the root, no genpath).</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">if </span><span >exist(</span><span style="color: #a709f5;">"leigqNEWTON_sphere_detect"</span><span >,</span><span style="color: #a709f5;">"file"</span><span >) ~= 2</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    thisFile = mfilename(</span><span style="color: #a709f5;">"fullpath"</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">if </span><span >~isempty(thisFile)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        rootGuess = fileparts(fileparts(fileparts(thisFile))); </span><span style="color: #008013;">% .../docs/source -&gt; toolbox root</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: #0e00ff;">if </span><span >exist(fullfile(rootGuess,</span><span style="color: #a709f5;">"leigqNEWTON_sphere_detect.m"</span><span >),</span><span style="color: #a709f5;">"file"</span><span >)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >            addpath(rootGuess);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >            rehash </span><span style="color: #a709f5;">toolboxcache</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">if </span><span >exist(</span><span style="color: #a709f5;">"leigqNEWTON_sphere_detect"</span><span >,</span><span style="color: #a709f5;">"file"</span><span >) ~= 2</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    error(</span><span style="color: #a709f5;">"Sphere functions not found on the MATLAB path. Add the toolbox root folder."</span><span >);</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div></div><h2  class = 'S9'><span>1) Choose a profile (recommended: "DOC")</span></h2><div  class = 'S2'><span>Profiles control the</span><span> </span><span style=' font-weight: bold;'>work budget</span><span> (RunsMax×Restarts) and the</span><span> </span><span style=' font-weight: bold;'>validation grid</span><span> size. If you previously observed very long runtimes, reduce RunsMax and/or Restarts.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >Profile = </span><span style="color: #a709f5;">"DOC"</span><span >;   </span><span style="color: #008013;">% "DOC" (default) | "FAST" (smoke) | "FULL" (research)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">switch </span><span >upper(Profile)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">case </span><span style="color: #a709f5;">"FAST"</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: #008013;">% Very quick smoke test. May produce "INCONCLUSIVE" if the validation grid is too small.</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        Collect   = 8;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        RunsMax   = 12;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        Restarts  = 40;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridTheta = 6;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridPhi   = 12;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridMaxPoints = 60;   </span><span style="color: #008013;">% &lt;-- may fall below MinGridForDecision (see below)</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        MinGridForDecision = 64;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        TargetRes = 1e-12;    </span><span style="color: #008013;">% relaxed for smoke tests</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        RefineArgs = {</span><span style="color: #a709f5;">"Mode"</span><span >,</span><span style="color: #a709f5;">"auto"</span><span >,</span><span style="color: #a709f5;">"TargetResMin"</span><span >,1e-12,</span><span style="color: #a709f5;">"Verbose"</span><span >,0};</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">case </span><span style="color: #a709f5;">"DOC"</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: #008013;">% Documentation-friendly: usually seconds, and the grid is large enough</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: #008013;">% to avoid the "INSUFFICIENT GRID SIZE" / "INCONCLUSIVE" outcome.</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        Collect   = 16;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        RunsMax   = 30;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        Restarts  = 80;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridTheta = 10;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridPhi   = 20;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridMaxPoints = 200;  </span><span style="color: #008013;">% &gt;= MinGridForDecision</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        MinGridForDecision = 64;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        TargetRes = 1e-13;    </span><span style="color: #008013;">% certificate threshold</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        RefineArgs = {</span><span style="color: #a709f5;">"Mode"</span><span >,</span><span style="color: #a709f5;">"auto"</span><span >,</span><span style="color: #a709f5;">"TargetResMin"</span><span >,1e-13,</span><span style="color: #a709f5;">"Verbose"</span><span >,0};</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">case </span><span style="color: #a709f5;">"FULL"</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        </span><span style="color: #008013;">% Research run (can be slow). Use when you need more distinct samples.</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        Collect   = 30;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        RunsMax   = 80;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        Restarts  = 200;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridTheta = 12;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridPhi   = 24;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        GridMaxPoints = 400;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        MinGridForDecision = 128;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        TargetRes = 1e-14;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        RefineArgs = {</span><span style="color: #a709f5;">"Mode"</span><span >,</span><span style="color: #a709f5;">"auto"</span><span >,</span><span style="color: #a709f5;">"TargetResMin"</span><span >,1e-14,</span><span style="color: #a709f5;">"Verbose"</span><span >,0};</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">otherwise</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >        error(</span><span style="color: #a709f5;">"Unknown Profile: %s"</span><span >, Profile);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >approxRestarts = RunsMax*Restarts;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >approxGrid = min(GridTheta*GridPhi, GridMaxPoints);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"Profile=%s | Collect=%d | RunsMax=%d | Restarts=%d | approxRestarts=%d | grid~%d pts\n"</span><span >, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >    Profile, Collect, RunsMax, Restarts, approxRestarts, approxGrid);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="82EB2CCB" prevent-scroll="true" data-testid="output_0" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class="textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">Profile=DOC | Collect=16 | RunsMax=30 | Restarts=80 | approxRestarts=2400 | grid~200 pts</div></div></div></div></div><h2  class = 'S9'><span>2) A small test matrix with a known spherical component (Huang–So style)</span></h2><div  class = 'S2'><span>This 2-by-2 example is intentionally small so that documentation runs are fast.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >qi = quaternion(0,1,0,0);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >A  = [ quaternion(2,0,0,0),  qi;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >      -qi,                  quaternion(2,0,0,0) ];</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >display(A);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsVariableStringElement" uid="B0D014B9" prevent-scroll="true" data-testid="output_1" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class="textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="49" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="variable output " tabindex="-1"><div style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><span class="variableNameElement" style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">A = <span class="headerElement" style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">2×2 quaternion array</span></span></div><div style="white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">     2 + 0i + 0j + 0k     0 + 1i + 0j + 0k
     0 - 1i + 0j + 0k     2 + 0i + 0j + 0k</div></div></div></div></div></div><h2  class = 'S9'><span>3) Detect: collect samples and fit sphere candidates (from DISTINCT samples)</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >tDetect = tic;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"\nDetection is fast:"</span><span >);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="469D7E09" prevent-scroll="true" data-testid="output_2" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">Detection is fast:</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"\n=== leigqNEWTON_sphere_detect ===\n"</span><span >);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="E7C97BFA" prevent-scroll="true" data-testid="output_3" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">=== leigqNEWTON_sphere_detect ===</div></div></div></div><div class="inlineWrapper"><div  class = 'S13'><span style="white-space: pre"><span >[lamAll, lamS, lam0, cls, sph, info] = leigqNEWTON_sphere_detect( </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    A, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"Collect"</span><span >,  Collect, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"RunsMax"</span><span >,  RunsMax, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"Restarts"</span><span >, Restarts, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"Seed0"</span><span >,    1, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"Report"</span><span >,   </span><span style="color: #a709f5;">"off"</span><span >); </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"Detect done in %.2fs: Ktot=%d  Kdistinct=%d  spheres=%d\n"</span><span >, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >    toc(tDetect), numel(lamAll), numel(lamS), numel(sph));</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="1345A89D" prevent-scroll="true" data-testid="output_4" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">Detect done in 0.06s: Ktot=16  Kdistinct=16  spheres=1</div></div></div></div></div><h2  class = 'S9'><span>4) Validate / refine (recommended entry point)</span></h2><div  class = 'S2'><span>If you ever see: "Sphere decision: INCONCLUSIVE ... Insufficient grid size ..." increase GridTheta/GridPhi and/or GridMaxPoints (and keep GridMaxPoints&gt;=MinGridForDecision).</span></div><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S14'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"\nValidation/refining is slow:"</span><span >);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="391AFCBA" prevent-scroll="true" data-testid="output_5" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">Validation/refining is slow:</div></div></div></div><div class="inlineWrapper"><div  class = 'S13'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C = struct();</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.A = A;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.lamAll = lamAll;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.lamSamples = lamS;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.cls = cls;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.sph = sph;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.info = info;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.idx = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.seedUsed = 1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >C.origin = </span><span style="color: #a709f5;">"doc_SphereHunting"</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >tVal = tic;</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"\n=== leigqNEWTON_sphere_validate ===\n"</span><span >);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="60A2E578" prevent-scroll="true" data-testid="output_6" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">=== leigqNEWTON_sphere_validate ===</div></div></div></div><div class="inlineWrapper"><div  class = 'S13'><span style="white-space: pre"><span >[A2, lamAll2, resAll, lamS2, resS, sph2, conf, out] = leigqNEWTON_sphere_validate( </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    C, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"Verbose"</span><span >, 1, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"TargetRes"</span><span >, TargetRes, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"RefineArgs"</span><span >, RefineArgs, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"GridTheta"</span><span >, GridTheta, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"GridPhi"</span><span >, GridPhi, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"GridMaxPoints"</span><span >, GridMaxPoints, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"MinGridForDecision"</span><span >, MinGridForDecision, </span><span style="color: #0e00ff;">...</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >    </span><span style="color: #a709f5;">"RefineGrid"</span><span >, true); </span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="A6327531" prevent-scroll="true" data-testid="output_7" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class="textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="179" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">=== leigqNEWTON_sphere_refine: idx=1, seed=1, origin=doc_SphereHunting ===
Ktot=16, Kdistinct=16, spheres=1
Initial residuals: lamAll  med=1.07e-15  max=1.89e-11 | lamSamples med=1.07e-15  max=1.89e-11
Refined residuals: lamAll  med=2.72e-17  max=9.33e-17 | lamSamples med=2.72e-17  max=9.33e-17
Inliers (n=16): res med=2.72e-17 max=9.33e-17
Inliers on-sphere (refit): devRel med=3.89e-16 max=6.66e-16
Eigenvalue certification (TargetRes=1.0e-13): lamAll pass=100% | lamSamples pass=100%
Sphere decision: SPHERE_CONFIRMED  reliability=HIGH (1.00)
  Why: Many grid points on the fitted sphere already have small residuals without refinement (continuum evidence).
Grid (no refine): N=200  passRes=100%  passSphere=100%  passBoth=100%
Grid (refined):  N=200  passRes=100%  passSphere=100%  passBoth=100%
Collapse clustering: K=154 attractor(s) (tol=1.0e-10). Largest clusters: [20 20 2 2 2]</div></div></div></div><div class="inlineWrapper"><div  class = 'S13'>&nbsp;</div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"Validate done in %.2fs.\n"</span><span >, toc(tVal));</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="4751FBF1" prevent-scroll="true" data-testid="output_8" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">Validate done in 37.73s.</div></div></div></div></div><h2  class = 'S9'><span>5) Quick interpretation hooks</span></h2><div  class = 'S2'><span>- resAll / resS: certificate-like values (smaller is better) - sph2: sphere model (empty if no sphere validated) - conf.sphere: decision + reliability score</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: #008013;">% Residual summary</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >medRes = median(resAll);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >maxRes = max(resAll);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"resAll: median = %.3e, max = %.3e\n"</span><span >, medRes, maxRes);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="876E374A" prevent-scroll="true" data-testid="output_9" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">resAll: median = 2.720e-17, max = 9.327e-17</div></div></div></div><div class="inlineWrapper"><div  class = 'S13'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #008013;">% Sphere model (struct or empty)</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"sph2:\n"</span><span >);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="5697C760" prevent-scroll="true" data-testid="output_10" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">sph2:</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre"><span >disp(sph2)</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="1613715F" prevent-scroll="true" data-testid="output_11" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="164" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">            center4: [2.0000 7.0768e-16 2.9432e-13 6.9955e-13]
             center: [1×1 quaternion]
             radius: 1.0000
           basis4x3: [4×3 double]
                 p0: [2.5387 -4.1492e-18 -0.7636 0.3559]
            center3: [3×1 double]
            inliers: [16×1 double]
           samples4: [4×1 quaternion]
            sampler: @(theta,phi)local_sphere_sampler(model,theta,phi)
    samplerOriginal: @(theta,phi)local_sphere_sampler(model,theta,phi)
      samplerStable: @(theta,phi)local_sphere_sampler(sph,theta,phi)</div></div></div></div><div class="inlineWrapper"><div  class = 'S13'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #008013;">% Sphere confidence (sub-struct)</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S10'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">"conf.sphere:\n"</span><span >);</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="8CB17074" prevent-scroll="true" data-testid="output_12" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class=" textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">conf.sphere:</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S12'><span style="white-space: pre"><span >disp(conf.sphere)</span></span></div><div  class = 'S11'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="B369431A" prevent-scroll="true" data-testid="output_13" style="width: 1139px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1"><div class="textElement eoOutputContent" data-previous-available-width="1102" data-previous-scroll-height="61" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" role="article" aria-roledescription="Use Browse Mode to explore " aria-description="text output " tabindex="-1">             verdict: 'SPHERE_CONFIRMED'
                 why: 'Many grid points on the fitted sphere already have small residuals without refinement (continuum evidence).'
      reliabilityTag: 'HIGH'
    reliabilityScore: 1</div></div></div></div><div class="inlineWrapper"><div  class = 'S13'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #008013;">% Tip: if Max residual is above TargetRes, either:</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span style="color: #008013;">%   - increase refinement effort (RefineArgs / TargetResMin), or</span></span></div></div><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre"><span style="color: #008013;">%   - relax TargetRes for documentation runs.</span></span></div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Sphere Hunting
% Tries to detect and validate *spherical components* in the left spectrum. 
% Typical workflow: 
%% 
% # sample many left-eigenvalue candidates (Newton runs) 
% # detect/fit candidate spheres from DISTINCT samples 
% # refine + validate (grid test) to decide sphere-vs-artifact
%% 
% This page is written to be *documentation-friendly*: - 
%% 
% * Default profile aims to finish quickly (less than a minute), yet produce 
% a reliable decision.
% * A heavier profile is provided for research runs.
%% 0) Setup (requirements + path)

rng(0,'twister'); 
hasQuat = true;
try
    quaternion(0,0,0,0);
catch
    hasQuat = false;
end
if ~hasQuat
    disp("This toolbox requires MATLAB's built-in quaternion class (Aerospace Toolbox).");
    disp("Examples in this page are skipped.");
    return;
end

% Ensure toolbox root is on the path (add only the root, no genpath).
if exist("leigqNEWTON_sphere_detect","file") ~= 2
    thisFile = mfilename("fullpath");
    if ~isempty(thisFile)
        rootGuess = fileparts(fileparts(fileparts(thisFile))); % .../docs/source -> toolbox root
        if exist(fullfile(rootGuess,"leigqNEWTON_sphere_detect.m"),"file")
            addpath(rootGuess);
            rehash toolboxcache
        end
    end
end
if exist("leigqNEWTON_sphere_detect","file") ~= 2
    error("Sphere functions not found on the MATLAB path. Add the toolbox root folder.");
end
%% 1) Choose a profile (recommended: "DOC")
% Profiles control the *work budget* (RunsMax×Restarts) and the *validation 
% grid* size. If you previously observed very long runtimes, reduce RunsMax and/or 
% Restarts.

Profile = "DOC";   % "DOC" (default) | "FAST" (smoke) | "FULL" (research)

switch upper(Profile)
    case "FAST"
        % Very quick smoke test. May produce "INCONCLUSIVE" if the validation grid is too small.
        Collect   = 8;
        RunsMax   = 12;
        Restarts  = 40;
        GridTheta = 6;
        GridPhi   = 12;
        GridMaxPoints = 60;   % <- may fall below MinGridForDecision (see below)
        MinGridForDecision = 64;

        TargetRes = 1e-12;    % relaxed for smoke tests
        RefineArgs = {"Mode","auto","TargetResMin",1e-12,"Verbose",0};

    case "DOC"
        % Documentation-friendly: usually seconds, and the grid is large enough
        % to avoid the "INSUFFICIENT GRID SIZE" / "INCONCLUSIVE" outcome.
        Collect   = 16;
        RunsMax   = 30;
        Restarts  = 80;
        GridTheta = 10;
        GridPhi   = 20;
        GridMaxPoints = 200;  % >= MinGridForDecision
        MinGridForDecision = 64;

        TargetRes = 1e-13;    % certificate threshold
        RefineArgs = {"Mode","auto","TargetResMin",1e-13,"Verbose",0};

    case "FULL"
        % Research run (can be slow). Use when you need more distinct samples.
        Collect   = 30;
        RunsMax   = 80;
        Restarts  = 200;
        GridTheta = 12;
        GridPhi   = 24;
        GridMaxPoints = 400;
        MinGridForDecision = 128;

        TargetRes = 1e-14;
        RefineArgs = {"Mode","auto","TargetResMin",1e-14,"Verbose",0};

    otherwise
        error("Unknown Profile: %s", Profile);
end

approxRestarts = RunsMax*Restarts;
approxGrid = min(GridTheta*GridPhi, GridMaxPoints);
fprintf("Profile=%s | Collect=%d | RunsMax=%d | Restarts=%d | approxRestarts=%d | grid~%d pts\n", ...
    Profile, Collect, RunsMax, Restarts, approxRestarts, approxGrid);
%% 2) A small test matrix with a known spherical component (Huang–So style)
% This 2-by-2 example is intentionally small so that documentation runs are 
% fast.

qi = quaternion(0,1,0,0);
A  = [ quaternion(2,0,0,0),  qi;
      -qi,                  quaternion(2,0,0,0) ];
display(A);
%% 3) Detect: collect samples and fit sphere candidates (from DISTINCT samples)

tDetect = tic;
fprintf("\nDetection is fast:");
fprintf("\n=== leigqNEWTON_sphere_detect ===\n");
[lamAll, lamS, lam0, cls, sph, info] = leigqNEWTON_sphere_detect( ...
    A, ...
    "Collect",  Collect, ...
    "RunsMax",  RunsMax, ...
    "Restarts", Restarts, ...
    "Seed0",    1, ...
    "Report",   "off"); 

fprintf("Detect done in %.2fs: Ktot=%d  Kdistinct=%d  spheres=%d\n", ...
    toc(tDetect), numel(lamAll), numel(lamS), numel(sph));
%% 4) Validate / refine (recommended entry point)
% If you ever see: "Sphere decision: INCONCLUSIVE ... Insufficient grid size 
% ..." increase GridTheta/GridPhi and/or GridMaxPoints (and keep GridMaxPoints>=MinGridForDecision).

fprintf("\nValidation/refining is slow:");

C = struct();
C.A = A;
C.lamAll = lamAll;
C.lamSamples = lamS;
C.cls = cls;
C.sph = sph;
C.info = info;
C.idx = 1;
C.seedUsed = 1;
C.origin = "doc_SphereHunting";

tVal = tic;
fprintf("\n=== leigqNEWTON_sphere_validate ===\n");
[A2, lamAll2, resAll, lamS2, resS, sph2, conf, out] = leigqNEWTON_sphere_validate( ...
    C, ...
    "Verbose", 1, ...
    "TargetRes", TargetRes, ...
    "RefineArgs", RefineArgs, ...
    "GridTheta", GridTheta, ...
    "GridPhi", GridPhi, ...
    "GridMaxPoints", GridMaxPoints, ...
    "MinGridForDecision", MinGridForDecision, ...
    "RefineGrid", true); 

fprintf("Validate done in %.2fs.\n", toc(tVal));
%% 5) Quick interpretation hooks
% - resAll / resS: certificate-like values (smaller is better) - sph2: sphere 
% model (empty if no sphere validated) - conf.sphere: decision + reliability score

% Residual summary
medRes = median(resAll);
maxRes = max(resAll);
fprintf("resAll: median = %.3e, max = %.3e\n", medRes, maxRes);

% Sphere model (struct or empty)
fprintf("sph2:\n");
disp(sph2)

% Sphere confidence (sub-struct)
fprintf("conf.sphere:\n");
disp(conf.sphere)

% Tip: if Max residual is above TargetRes, either:
%   - increase refinement effort (RefineArgs / TargetResMin), or
%   - relax TargetRes for documentation runs.
##### SOURCE END #####
-->
</div></body></html>